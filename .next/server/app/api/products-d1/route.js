"use strict";(()=>{var e={};e.id=7110,e.ids=[7110],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},8544:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>A,originalPathname:()=>h,patchFetch:()=>D,requestAsyncStorage:()=>R,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>I});var a={};r.r(a),r.d(a,{DELETE:()=>E,GET:()=>f,POST:()=>p,PUT:()=>_});var i=r(5419),s=r(9108),o=r(9678),c=r(8070),n=r(2002),u=r(7935);function d(e,t="Success",r={}){return c.Z.json({success:!0,message:t,data:e,meta:r})}function l(e,t="ERROR",r=500){return c.Z.json({success:!1,error:e,code:t},{status:r})}async function f(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),a=Math.min(parseInt(t.get("limit")||"20"),100),i=t.get("search")||"",s=t.get("category")||"",o="true"===t.get("featured"),c=t.get("sortBy")||"created_at",n=t.get("sortOrder")||"DESC";if(!u.ki.isAvailable())return l("Database not available","DB_UNAVAILABLE",503);let f=["is_active = 1"],p=[];i&&(f.push("(name LIKE ? OR description LIKE ?)"),p.push(`%${i}%`,`%${i}%`)),s&&(f.push("category_id = ?"),p.push(s)),o&&f.push("is_featured = 1");let _=f.join(" AND "),E=(r-1)*a,g=await u.ki.getRecords("products",{where:_,params:p,orderBy:`${c} ${n}`,limit:a,offset:E});if(!g.success)return l(g.error||"Failed to fetch products","FETCH_FAILED");let R=g.data?.map(e=>({...e,images:u.cf.fromJson(e.images||null)||[],features:u.cf.fromJson(e.features||null)||[],applications:u.cf.fromJson(e.applications||null)||[],specifications:u.cf.fromJson(e.specifications||null)||{},catalog_files:u.cf.fromJson(e.catalog_files||null)||[]}))||[];return d(R,"Products fetched successfully",{pagination:{page:r,limit:a,total:g.total||0,totalPages:Math.ceil((g.total||0)/a)}})}catch(e){return console.error("Products GET error:",e),l("Internal server error","SERVER_ERROR")}}async function p(e){try{let t=e.cookies.get("accessToken")?.value||e.headers.get("authorization")?.replace("Bearer ","");if(!t)return l("Authentication required","AUTH_REQUIRED",401);let r=await n.e8.verifyAccessToken(t);if(!r.success)return l("Invalid authentication","AUTH_FAILED",401);if(!n.e8.hasRole(r.user,"admin"))return l("Insufficient permissions","PERMISSION_DENIED",403);if(!u.ki.isAvailable())return l("Database not available","DB_UNAVAILABLE",503);let a=await e.json(),i=["name","category_id","subcategory_id"].filter(e=>!a[e]);if(i.length>0)return l(`Missing required fields: ${i.join(", ")}`,"VALIDATION_ERROR",400);let s=u.cf.generateId(),o=u.cf.formatDate(),c={id:s,name:a.name.trim(),description:a.description?.trim()||void 0,overview:a.overview?.trim()||void 0,category_id:a.category_id,subcategory_id:a.subcategory_id,image:a.image||void 0,images:a.images?u.cf.toJson(a.images):void 0,features:a.features?u.cf.toJson(a.features):void 0,applications:a.applications?u.cf.toJson(a.applications):void 0,specifications:a.specifications?u.cf.toJson(a.specifications):void 0,data_sheet:a.data_sheet||void 0,catalog_files:a.catalog_files?u.cf.toJson(a.catalog_files):void 0,price:a.price||void 0,is_warrantied:!!a.is_warrantied,has_free_shipping:!!a.has_free_shipping,is_featured:!!a.is_featured,is_active:!1!==a.is_active,display_order:a.display_order||0,meta_title:a.meta_title?.trim()||void 0,meta_description:a.meta_description?.trim()||void 0,meta_keywords:a.meta_keywords?.trim()||void 0,created_at:o,updated_at:o},f=await u.ki.insertRecord("products",c);if(!f.success)return l(f.error||"Failed to create product","CREATE_FAILED");return d({id:s,...c},"Product created successfully",{created_by:r.user.username})}catch(e){return console.error("Products POST error:",e),l("Internal server error","SERVER_ERROR")}}async function _(e){try{let t=e.cookies.get("accessToken")?.value||e.headers.get("authorization")?.replace("Bearer ","");if(!t)return l("Authentication required","AUTH_REQUIRED",401);let r=await n.e8.verifyAccessToken(t);if(!r.success)return l("Invalid authentication","AUTH_FAILED",401);if(!n.e8.hasRole(r.user,"admin"))return l("Insufficient permissions","PERMISSION_DENIED",403);if(!u.ki.isAvailable())return l("Database not available","DB_UNAVAILABLE",503);let{id:a,...i}=await e.json();if(!a)return l("Product ID is required","VALIDATION_ERROR",400);let s=await u.ki.getRecordById("products",a);if(!s.success||!s.data)return l("Product not found","NOT_FOUND",404);let o=u.cf.formatDate(),c={...i,updated_at:o};i.images&&(c.images=u.cf.toJson(i.images)),i.features&&(c.features=u.cf.toJson(i.features)),i.applications&&(c.applications=u.cf.toJson(i.applications)),i.specifications&&(c.specifications=u.cf.toJson(i.specifications)),i.catalog_files&&(c.catalog_files=u.cf.toJson(i.catalog_files));let f=await u.ki.updateRecord("products",a,c);if(!f.success)return l(f.error||"Failed to update product","UPDATE_FAILED");return d({id:a,...c},"Product updated successfully",{updated_by:r.user.username})}catch(e){return console.error("Products PUT error:",e),l("Internal server error","SERVER_ERROR")}}async function E(e){try{let t=e.cookies.get("accessToken")?.value||e.headers.get("authorization")?.replace("Bearer ","");if(!t)return l("Authentication required","AUTH_REQUIRED",401);let r=await n.e8.verifyAccessToken(t);if(!r.success)return l("Invalid authentication","AUTH_FAILED",401);if(!n.e8.hasRole(r.user,"admin"))return l("Insufficient permissions","PERMISSION_DENIED",403);if(!u.ki.isAvailable())return l("Database not available","DB_UNAVAILABLE",503);let{searchParams:a}=new URL(e.url),i=a.get("id");if(!i)return l("Product ID is required","VALIDATION_ERROR",400);let s=await u.ki.getRecordById("products",i);if(!s.success||!s.data)return l("Product not found","NOT_FOUND",404);let o=await u.ki.deleteRecord("products",i);if(!o.success)return l(o.error||"Failed to delete product","DELETE_FAILED");return d({id:i},"Product deleted successfully",{deleted_by:r.user.username})}catch(e){return console.error("Products DELETE error:",e),l("Internal server error","SERVER_ERROR")}}let g=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/products-d1/route",pathname:"/api/products-d1",filename:"route",bundlePath:"app/api/products-d1/route"},resolvedPagePath:"/Users/denizhan/Documents/Windsurf/protekanalitik/src/app/api/products-d1/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:R,staticGenerationAsyncStorage:m,serverHooks:v,headerHooks:A,staticGenerationBailout:I}=g,h="/api/products-d1/route";function D(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,5669,6458],()=>r(8544));module.exports=a})();