"use strict";(()=>{var e={};e.id=3873,e.ids=[3873],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},648:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>b,originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>k,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>h});var r={};i.r(r),i.d(r,{GET:()=>c,POST:()=>p});var a=i(5419),n=i(9108),s=i(9678),l=i(2002),o=i(6176),d=i(9413),u=i(1494);let _=[{id:"event-1",title:"G\xfcvenlik Teknolojileri Semineri",slug:"guvenlik-teknolojileri-semineri",description:"Modern g\xfcvenlik teknolojileri ve uygulamaları hakkında kapsamlı seminer",content:"Bu seminerde son teknoloji g\xfcvenlik \xe7\xf6z\xfcmlerini ve uygulamalarını detaylı olarak inceleyeceğiz.",event_type:"seminer",start_date:"2024-02-15",end_date:"2024-02-15",location:"İstanbul Kongre Merkezi",address:"Harbiye, İstanbul",registration_url:"https://example.com/register",max_participants:100,current_participants:45,image_url:"/images/events/security-seminar.jpg",tags:"g\xfcvenlik,teknoloji,seminer",is_featured:!0,is_published:!0,registration_required:!0,is_online:!1,meeting_link:"",meta_title:"G\xfcvenlik Teknolojileri Semineri - Protek Analitik",meta_description:"Modern g\xfcvenlik teknolojileri semineri",meta_keywords:"g\xfcvenlik,teknoloji,seminer",created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T10:00:00Z",created_by:"admin"},{id:"event-2",title:"Online Webinar: Siber G\xfcvenlik",slug:"online-webinar-siber-guvenlik",description:"Siber g\xfcvenlik tehditleri ve korunma y\xf6ntemleri",content:"Siber g\xfcvenlik alanındaki en g\xfcncel tehditler ve korunma stratejilerini ele alacağımız webinar.",event_type:"webinar",start_date:"2024-03-01",end_date:"2024-03-01",location:"Online",address:"",registration_url:"https://example.com/webinar",max_participants:500,current_participants:234,image_url:"/images/events/cyber-security-webinar.jpg",tags:"siber g\xfcvenlik,webinar,online",is_featured:!1,is_published:!0,registration_required:!0,is_online:!0,meeting_link:"https://zoom.us/meeting/123",meta_title:"Siber G\xfcvenlik Webinarı - Protek Analitik",meta_description:"Siber g\xfcvenlik tehditleri ve korunma y\xf6ntemleri webinarı",meta_keywords:"siber g\xfcvenlik,webinar,online",created_at:"2024-01-20T14:00:00Z",updated_at:"2024-01-20T14:00:00Z",created_by:"admin"}];async function c(e){try{let t=e.cookies.get("accessToken")?.value||e.headers.get("authorization")?.replace("Bearer ","");if(!t)return d.C4.MISSING_TOKEN();if(!(await l.e8.verifyAccessToken(t)).success)return d.C4.INVALID_TOKEN();let i=(0,u.j)(),r=[];if(i)try{r=(await i.prepare(`
          SELECT * FROM events 
          ORDER BY start_date DESC, created_at DESC
        `).all()).results||[],console.log(`Fetched ${r.length} events from D1 database`)}catch(e){console.error("D1 query error:",e),r=_,console.log("Using mock events data due to D1 error")}else r=_,console.log("Using mock events data (D1 not available)");return(0,d.x_)(r,"Events fetched successfully",{total:r.length,lastUpdated:new Date().toISOString()})}catch(e){return console.error("Events fetch error:",e),d.Gl.SERVER_ERROR("Failed to fetch events")}}async function p(e){try{let t=e.cookies.get("accessToken")?.value||e.headers.get("authorization")?.replace("Bearer ","");if(!t)return d.C4.MISSING_TOKEN();let i=await l.e8.verifyAccessToken(t);if(!i.success)return d.C4.INVALID_TOKEN();if(!l.e8.hasRole(i.user,"editor"))return d.C4.INSUFFICIENT_PERMISSIONS();let r=await e.json(),a=(0,d.MN)(r,["title","event_type","start_date"]);if(!a.isValid)return(0,d.jl)(`Missing required fields: ${a.missingFields.join(", ")}`,"MISSING_REQUIRED_FIELDS",400);let n=[];("string"!=typeof r.title||r.title.trim().length<5)&&n.push("Title must be at least 5 characters long"),["seminer","webinar","fuar","egitim","konferans"].includes(r.event_type)||n.push("Invalid event type. Must be one of: seminer, webinar, fuar, egitim, konferans");let s=new Date(r.start_date);if(isNaN(s.getTime())&&n.push("Invalid start date format"),r.end_date){let e=new Date(r.end_date);isNaN(e.getTime())?n.push("Invalid end date format"):e<=s&&n.push("End date must be after start date")}if(r.max_participants&&(isNaN(r.max_participants)||r.max_participants<1)&&n.push("Max participants must be a positive number"),n.length>0)return(0,d.jl)("Validation failed","VALIDATION_ERROR",400,{errors:n});let _=r.id||o.l3.generateId(),c=r.slug||o.l3.generateSlug(r.title),p=(0,u.j)();if(p)try{if(await p.prepare("SELECT id FROM events WHERE slug = ?").bind(c).first())return(0,d.jl)("An event with this slug already exists","DUPLICATE_SLUG",409);let e=o.l3.formatDate(),t={id:_,title:r.title.trim(),slug:c,description:r.description?.trim()||"",content:r.content?o.v$.sanitizeHtml(r.content):"",event_type:r.event_type,start_date:r.start_date,end_date:r.end_date||null,location:r.location?.trim()||"",address:r.address?.trim()||"",registration_url:r.registration_url||"",max_participants:r.max_participants||null,current_participants:0,image_url:r.image_url||"",tags:"string"==typeof r.tags?r.tags:JSON.stringify(r.tags||[]),is_featured:r.is_featured?1:0,is_published:!1!==r.is_published?1:0,registration_required:r.registration_required?1:0,is_online:r.is_online?1:0,meeting_link:r.meeting_link||"",meta_title:r.meta_title||r.title,meta_description:r.meta_description||r.description||r.title,meta_keywords:r.meta_keywords||"",created_at:e,updated_at:e,created_by:i.user.id};await p.prepare(`
          INSERT INTO events (
            id, title, slug, description, content, event_type, start_date, end_date,
            location, address, registration_url, max_participants, current_participants,
            image_url, tags, is_featured, is_published, registration_required, is_online,
            meeting_link, meta_title, meta_description, meta_keywords,
            created_at, updated_at, created_by
          ) VALUES (
            ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?
          )
        `).bind(t.id,t.title,t.slug,t.description,t.content,t.event_type,t.start_date,t.end_date,t.location,t.address,t.registration_url,t.max_participants,t.current_participants,t.image_url,t.tags,t.is_featured,t.is_published,t.registration_required,t.is_online,t.meeting_link,t.meta_title,t.meta_description,t.meta_keywords,t.created_at,t.updated_at,t.created_by).run(),console.log(`Event created in D1: ${t.id} by user ${i.user.username}`);let a={...t,is_featured:!!t.is_featured,is_published:!!t.is_published,registration_required:!!t.registration_required,is_online:!!t.is_online};return d.$X.CREATED(a,"Event")}catch(e){return console.error("D1 event creation error:",e),d.Gl.SERVER_ERROR("Failed to save event to database")}else{console.log("D1 not available, returning mock event creation success");let e={id:_,title:r.title.trim(),slug:c,description:r.description?.trim()||"",event_type:r.event_type,start_date:r.start_date,created_at:o.l3.formatDate(),updated_at:o.l3.formatDate()};return d.$X.CREATED(e,"Event")}}catch(e){return console.error("Event creation error:",e),d.Gl.SERVER_ERROR("Failed to create event")}}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/events/route",pathname:"/api/events",filename:"route",bundlePath:"app/api/events/route"},resolvedPagePath:"/Users/denizhan/Documents/Windsurf/protekanalitik/src/app/api/events/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:k,headerHooks:b,staticGenerationBailout:h}=m,f="/api/events/route";function y(){return(0,s.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:v})}}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[1638,6206,5669,9745],()=>i(648));module.exports=r})();