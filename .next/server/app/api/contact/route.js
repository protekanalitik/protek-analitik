"use strict";(()=>{var e={};e.id=386,e.ids=[386],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},6472:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>h,originalPathname:()=>f,patchFetch:()=>E,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>_,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>y});var s={};a.r(s),a.d(s,{GET:()=>c,POST:()=>m});var r=a(5419),i=a(9108),n=a(9678),o=a(2002),l=a(7935),u=a(9413);async function c(e){try{let t=e.cookies.get("accessToken")?.value||e.headers.get("authorization")?.replace("Bearer ","");if(!t)return u.C4.MISSING_TOKEN();let a=await o.e8.verifyAccessToken(t);if(!a.success)return u.C4.INVALID_TOKEN();if(!o.e8.hasRole(a.user,"admin"))return u.C4.INSUFFICIENT_PERMISSIONS();let s=new URL(e.url),r=s.searchParams.get("message_type"),i=s.searchParams.get("priority"),n=s.searchParams.get("is_read"),c=s.searchParams.get("is_responded"),m=s.searchParams.get("search"),d=Math.min(parseInt(s.searchParams.get("limit")||"50"),100),p=parseInt(s.searchParams.get("offset")||"0");if(l.ki.isAvailable())try{let e=[],t=[];if(r&&(e.push("message_type = ?"),t.push(r)),i&&(e.push("priority = ?"),t.push(i)),null!==n&&""!==n&&(e.push("is_read = ?"),t.push("true"===n?1:0)),null!==c&&""!==c&&(e.push("is_responded = ?"),t.push("true"===c?1:0)),m){e.push("(first_name LIKE ? OR last_name LIKE ? OR email LIKE ? OR subject LIKE ? OR message LIKE ? OR company LIKE ?)");let a=`%${m}%`;t.push(a,a,a,a,a,a)}let a=e.length>0?e.join(" AND "):"",s=await l.ki.getRecords("contact_messages",{where:a,params:t,orderBy:"created_at DESC",limit:d,offset:p});if(s.success&&s.data)return(0,u.x_)(s.data,"Contact messages fetched successfully",{total:s.total||0,limit:d,offset:p,hasMore:p+d<(s.total||0),source:"d1_database"})}catch(e){console.error("D1 database error:",e)}console.log("⚠️ D1 database not available - returning mock messages");let g=[{id:"msg-001",first_name:"Ahmet",last_name:"Yılmaz",email:"ahmet.yilmaz@example.com",phone:"+90 532 123 45 67",company:"ABC Teknoloji",position:"Proje M\xfcd\xfcr\xfc",subject:"BRIX \xd6l\xe7\xfcm Cihazı Hakkında Bilgi",message:"Merhaba, şirketimizde kullanmak \xfczere BRIX \xf6l\xe7\xfcm cihazları hakkında detaylı bilgi almak istiyorum. Fiyat teklifi g\xf6nderebilir misiniz?",message_type:"teklif-talebi",interested_products:"BRIX-001",budget_range:"10000-50000",timeline:"1-3-ay",source:"website-form",is_read:!1,is_responded:!1,priority:"high",assigned_to:null,response_notes:null,ip_address:"192.168.1.100",user_agent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",created_at:new Date(Date.now()-72e5).toISOString(),updated_at:new Date(Date.now()-72e5).toISOString()},{id:"msg-002",first_name:"Zeynep",last_name:"Kaya",email:"zeynep.kaya@labtech.com.tr",phone:"+90 212 987 65 43",company:"LabTech Analiz",position:"Laboratuvar Sorumlusu",subject:"Su Aktivitesi \xd6l\xe7\xfcm Cihazı Teknik Destek",message:"Cihazımızda kalibrasyon hatası alıyoruz. Teknik ekibinizden destek talep ediyoruz.",message_type:"teknik-destek",interested_products:"su-aktivite-001",budget_range:"",timeline:"hemen",source:"website-form",is_read:!0,is_responded:!1,priority:"urgent",assigned_to:"teknik-ekip",response_notes:null,ip_address:"192.168.1.101",user_agent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36",created_at:new Date(Date.now()-144e5).toISOString(),updated_at:new Date(Date.now()-36e5).toISOString()},{id:"msg-003",first_name:"Mehmet",last_name:"\xd6zer",email:"m.ozer@gmail.com",phone:"+90 533 456 78 90",company:"\xd6zg\xfcr Danışmanlık",position:"Genel M\xfcd\xfcr",subject:"İş Birliği Fırsatları",message:"Distrib\xfct\xf6rl\xfck konusunda g\xf6r\xfcşmek istiyoruz. Uygun bir zamanda toplantı ayarlayabilir miyiz?",message_type:"is-birligi",interested_products:"",budget_range:"",timeline:"1-ay",source:"website-form",is_read:!0,is_responded:!0,priority:"normal",assigned_to:"satis-ekip",response_notes:"Toplantı 15 Şubat i\xe7in planlandı",ip_address:"192.168.1.102",user_agent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",created_at:new Date(Date.now()-864e5).toISOString(),updated_at:new Date(Date.now()-432e5).toISOString()},{id:"msg-004",first_name:"Fatma",last_name:"Demir",email:"fatma.demir@university.edu.tr",phone:"+90 312 555 12 34",company:"Ankara \xdcniversitesi",position:"Araştırma G\xf6revlisi",subject:"Akademik İndirim Bilgisi",message:"Araştırma projemiz i\xe7in magnetik karıştırıcı almayı planlıyoruz. Akademik indirim uygulanıyor mu?",message_type:"satis",interested_products:"magnetik-karistirici-ms300",budget_range:"5000-10000",timeline:"2-4-hafta",source:"website-form",is_read:!1,is_responded:!1,priority:"normal",assigned_to:null,response_notes:null,ip_address:"192.168.1.103",user_agent:"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36",created_at:new Date(Date.now()-216e5).toISOString(),updated_at:new Date(Date.now()-216e5).toISOString()},{id:"msg-005",first_name:"Ali",last_name:"Veli",email:"info@kalibrasyonlab.com",phone:"+90 216 888 99 00",company:"Kalibrasyon Laboratuvarı",position:"M\xfcd\xfcr",subject:"Genel Bilgi Talebi",message:"\xdcr\xfcn kataloğunuzu incelemek istiyoruz. PDF olarak g\xf6nderebilir misiniz?",message_type:"genel",interested_products:"",budget_range:"",timeline:"",source:"website-form",is_read:!0,is_responded:!0,priority:"low",assigned_to:"destek-ekip",response_notes:"Katalog e-posta ile g\xf6nderildi",ip_address:"192.168.1.104",user_agent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_7_1 like Mac OS X)",created_at:new Date(Date.now()-1728e5).toISOString(),updated_at:new Date(Date.now()-864e5).toISOString()}];if(r&&(g=g.filter(e=>e.message_type===r)),i&&(g=g.filter(e=>e.priority===i)),null!==n&&""!==n){let e="true"===n;g=g.filter(t=>t.is_read===e)}if(null!==c&&""!==c){let e="true"===c;g=g.filter(t=>t.is_responded===e)}if(m){let e=m.toLowerCase();g=g.filter(t=>t.first_name?.toLowerCase().includes(e)||t.last_name?.toLowerCase().includes(e)||t.email.toLowerCase().includes(e)||t.subject.toLowerCase().includes(e)||t.message.toLowerCase().includes(e)||t.company?.toLowerCase().includes(e))}let _=g.length,h=g.slice(p,p+d);return(0,u.x_)(h,"Contact messages fetched successfully (development mode)",{total:_,limit:d,offset:p,hasMore:p+d<_,source:"mock-data"})}catch(e){return console.error("Contact messages fetch error:",e),u.Gl.SERVER_ERROR("Failed to fetch contact messages")}}async function m(e){try{var t;let a=await e.json(),s=a.name&&"string"==typeof a.name,r=a.first_name&&"string"==typeof a.first_name;if(!s&&!r)return(0,u.jl)("Either name or first_name is required","MISSING_REQUIRED_FIELDS",400);let i=(0,u.MN)(a,["email","subject","message"]);if(!i.isValid)return(0,u.jl)(`Missing required fields: ${i.missingFields.join(", ")}`,"MISSING_REQUIRED_FIELDS",400);let n=[];s&&a.name.trim().length<2&&n.push("Name must be at least 2 characters long"),r&&a.first_name.trim().length<2&&n.push("First name must be at least 2 characters long"),"string"==typeof a.email&&(t=a.email,/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))||n.push("Valid email address is required"),("string"!=typeof a.subject||a.subject.trim().length<5)&&n.push("Subject must be at least 5 characters long"),("string"!=typeof a.message||a.message.trim().length<10)&&n.push("Message must be at least 10 characters long"),a.phone&&("string"!=typeof a.phone||a.phone.trim().length<10)&&n.push("Phone number must be at least 10 characters long"),a.company&&("string"!=typeof a.company||a.company.trim().length<2)&&n.push("Company name must be at least 2 characters long");let o=["genel","teknik-destek","satis","teklif-talebi","is-birligi"];if(a.message_type&&!o.includes(a.message_type)&&n.push(`Invalid message type. Must be one of: ${o.join(", ")}`),n.length>0)return(0,u.jl)("Validation failed","VALIDATION_ERROR",400,{errors:n});let c=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown",m="msg_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),d=new Date().toISOString(),p="",g="";if(a.first_name)p=a.first_name.trim(),g=a.last_name?.trim()||"";else if(a.name){let e=a.name.trim().split(" ");p=e[0]||"",g=e.slice(1).join(" ")||""}let _={id:m,first_name:p,last_name:g,email:a.email.trim().toLowerCase(),phone:a.phone?.trim()||"",company:a.company?.trim()||"",position:a.position?.trim()||"",subject:a.subject.trim(),message:a.message.trim().replace(/<[^>]*>/g,"").trim(),message_type:a.message_type||"genel",interested_products:a.interested_products||"",budget_range:a.budget_range||"",timeline:a.timeline||"",source:a.source||"website",is_read:!1,is_responded:!1,priority:a.priority||"normal",assigned_to:"",response_notes:"",ip_address:c,user_agent:e.headers.get("user-agent")||"",created_at:d,updated_at:d};if(l.ki.isAvailable())try{let e=new Date(Date.now()-6e5).toISOString(),t=await l.ki.executeQuery("SELECT COUNT(*) as count FROM contact_messages WHERE ip_address = ? AND created_at > ?",[c,e]);if(t.success&&t.data?.[0]?.count>=3)return(0,u.jl)("Bu IP adresinden son 10 dakikada \xe7ok fazla mesaj g\xf6nderildi. L\xfctfen bekleyiniz.","RATE_LIMIT_EXCEEDED",429);let a=await l.ki.insertRecord("contact_messages",_);if(!a.success)return console.error("Failed to save contact message to D1:",a.error),u.Gl.SERVER_ERROR("Failed to save contact message");{console.log(`Contact message received: ${m} from ${_.email}`);let e={id:m,subject:_.subject,message_type:_.message_type,created_at:_.created_at};return u.$X.CREATED(e,"Contact message")}}catch(e){return console.error("D1 database error:",e),u.Gl.SERVER_ERROR("Database error occurred")}console.log("⚠️ D1 database not available - mock contact message creation");let h={id:m,subject:_.subject,message_type:_.message_type,created_at:_.created_at};return u.$X.CREATED(h,"Contact message (development mode)")}catch(e){return console.error("Contact message creation error:",e),u.Gl.SERVER_ERROR("Failed to send contact message")}}let d=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/contact/route",pathname:"/api/contact",filename:"route",bundlePath:"app/api/contact/route"},resolvedPagePath:"/Users/denizhan/Documents/Windsurf/protekanalitik/src/app/api/contact/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:_,headerHooks:h,staticGenerationBailout:y}=d,f="/api/contact/route";function E(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:g})}},9413:(e,t,a)=>{a.d(t,{$X:()=>l,C4:()=>n,Gl:()=>o,MN:()=>u,jl:()=>i,x_:()=>r});var s=a(8070);function r(e,t,a){let r={success:!0,message:t,data:e,meta:{timestamp:new Date().toISOString(),version:"1.0.0",...a}};return s.Z.json(r)}function i(e,t,a=400,r){let i={success:!1,error:e,code:t,meta:{timestamp:new Date().toISOString(),version:"1.0.0",...r}};return s.Z.json(i,{status:a})}let n={MISSING_TOKEN:()=>i("Authentication token required","MISSING_TOKEN",401),INVALID_TOKEN:()=>i("Invalid or expired token","INVALID_TOKEN",401),INSUFFICIENT_PERMISSIONS:()=>i("Insufficient permissions","INSUFFICIENT_PERMISSIONS",403),RATE_LIMITED:e=>{let t=i("Too many requests. Please try again later.","RATE_LIMITED",429);return e&&t.headers.set("Retry-After",e.toString()),t}},o={NOT_FOUND:(e="Resource")=>i(`${e} not found`,"NOT_FOUND",404),ALREADY_EXISTS:(e="Resource")=>i(`${e} already exists`,"ALREADY_EXISTS",409),SERVER_ERROR:(e="Internal server error")=>i(e,"SERVER_ERROR",500),BAD_REQUEST:(e="Bad request")=>i(e,"BAD_REQUEST",400),FORBIDDEN:(e="Access forbidden")=>i(e,"FORBIDDEN",403)},l={CREATED:(e,t="Resource")=>r(e,`${t} created successfully`),UPDATED:(e,t="Resource")=>r(e,`${t} updated successfully`),DELETED:(e="Resource")=>r(null,`${e} deleted successfully`),FETCHED:(e,t="Resource")=>r(e,`${t} fetched successfully`)};function u(e,t){let a=t.filter(t=>void 0===e[t]||null===e[t]||""===e[t]);return{isValid:0===a.length,missingFields:a}}class c{static{this.requests=new Map}static isRateLimited(e,t=100,a=6e4){let s=Date.now(),r=this.requests.get(e);return!r||s>r.resetTime?(this.requests.set(e,{count:1,resetTime:s+a}),!1):r.count>=t||(r.count++,!1)}static getRemainingRequests(e,t=100){let a=this.requests.get(e);return a?Math.max(0,t-a.count):t}static cleanup(){let e=Date.now();for(let[t,a]of Array.from(this.requests.entries()))e>a.resetTime&&this.requests.delete(t)}}"undefined"!=typeof setInterval&&setInterval(()=>{c.cleanup()},3e5)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[1638,6206,5669,6458],()=>a(6472));module.exports=s})();