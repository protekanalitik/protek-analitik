"use strict";(()=>{var e={};e.id=505,e.ids=[505],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},1017:e=>{e.exports=require("path")},450:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>T,originalPathname:()=>k,patchFetch:()=>w,requestAsyncStorage:()=>E,routeModule:()=>_,serverHooks:()=>R,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>S});var a={};r.r(a),r.d(a,{GET:()=>y,POST:()=>g});var s=r(5419),n=r(9108),i=r(9678);let o=require("fs");var c=r.n(o),u=r(1017),l=r.n(u),d=r(2002),p=r(6176),m=r(9413);let f=l().join(process.cwd(),"src/data/quote-requests.json");function h(){return c().existsSync(f)?JSON.parse(c().readFileSync(f,"utf-8")):{quotes:[]}}async function y(e){try{let t=e.cookies.get("accessToken")?.value||e.headers.get("authorization")?.replace("Bearer ","");if(!t)return m.C4.MISSING_TOKEN();let r=await d.e8.verifyAccessToken(t);if(!r.success)return m.C4.INVALID_TOKEN();if(!d.e8.hasRole(r.user,"admin")&&!d.e8.hasRole(r.user,"editor"))return m.C4.INSUFFICIENT_PERMISSIONS();let a=h(),s=a.quotes||[],n=new URL(e.url),i=n.searchParams.get("status"),o=n.searchParams.get("priority"),c=parseInt(n.searchParams.get("limit")||"50"),u=parseInt(n.searchParams.get("offset")||"0"),l=s;i&&(l=l.filter(e=>e.status===i)),o&&(l=l.filter(e=>e.priority===o));let p=l.sort((e,t)=>{let r=new Date(e.created_at||0).getTime();return new Date(t.created_at||0).getTime()-r}).slice(u,u+c);return(0,m.x_)(p,"Quote requests fetched successfully",{total:l.length,limit:c,offset:u,hasMore:u+c<l.length,lastUpdated:a.lastUpdated||new Date().toISOString()})}catch(e){return console.error("Quote requests fetch error:",e),m.Gl.SERVER_ERROR("Failed to fetch quote requests")}}async function g(e){try{let t=await e.json(),r=(0,m.MN)(t,["company_name","contact_name","email","phone","project_type","budget_range"]);if(!r.isValid)return(0,m.jl)(`Missing required fields: ${r.missingFields.join(", ")}`,"MISSING_REQUIRED_FIELDS",400);let a=[];("string"!=typeof t.company_name||t.company_name.trim().length<2)&&a.push("Company name must be at least 2 characters long"),("string"!=typeof t.contact_name||t.contact_name.trim().length<2)&&a.push("Contact name must be at least 2 characters long"),"string"==typeof t.email&&p.v$.isValidEmail(t.email)||a.push("Valid email address is required"),("string"!=typeof t.phone||t.phone.trim().length<10)&&a.push("Phone number must be at least 10 characters long");let s=["laboratory-setup","equipment-supply","maintenance","consultation","training","other"];s.includes(t.project_type)||a.push(`Invalid project type. Must be one of: ${s.join(", ")}`);let n=["under-10k","10k-50k","50k-100k","100k-500k","over-500k","not-specified"];if(n.includes(t.budget_range)||a.push(`Invalid budget range. Must be one of: ${n.join(", ")}`),t.timeline){let e=["immediate","1-month","3-months","6-months","1-year","flexible"];e.includes(t.timeline)||a.push(`Invalid timeline. Must be one of: ${e.join(", ")}`)}if(t.products&&!Array.isArray(t.products)&&a.push("Products must be an array"),a.length>0)return(0,m.jl)("Validation failed","VALIDATION_ERROR",400,{errors:a});let i=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown",o=h(),u=new Date(Date.now()-864e5);if(o.quotes.filter(e=>e.ip_address===i&&new Date(e.created_at)>u).length>=2)return(0,m.jl)("Too many quote requests sent recently. Please wait before sending another request.","RATE_LIMIT_EXCEEDED",429);let l=p.l3.generateId(),d=`QR-${new Date().getFullYear()}-${String(Date.now()).slice(-6)}`,y=p.l3.formatDate(),g={id:l,quote_number:d,company_name:t.company_name.trim(),contact_name:t.contact_name.trim(),email:t.email.trim().toLowerCase(),phone:t.phone.trim(),position:t.position?.trim()||"",address:t.address?.trim()||"",city:t.city?.trim()||"",country:t.country?.trim()||"",project_type:t.project_type,project_description:t.project_description?.trim()||"",budget_range:t.budget_range,timeline:t.timeline||"not-specified",products:Array.isArray(t.products)?t.products:[],requirements:t.requirements?.trim()||"",additional_notes:t.additional_notes?.trim()||"",status:"new",priority:"normal",assigned_to:null,estimated_value:null,quote_valid_until:null,follow_up_date:null,source:t.source||"website",ip_address:i,user_agent:e.headers.get("user-agent")||"",referrer:e.headers.get("referer")||"",attachments:[],internal_notes:"",created_at:y,updated_at:y,quoted_at:null,accepted_at:null};o.quotes.unshift(g),o.lastUpdated=y,c().writeFileSync(f,JSON.stringify(o,null,2),"utf-8"),console.log(`Quote request received: ${g.quote_number} from ${g.company_name}`);let _={id:g.id,quote_number:g.quote_number,company_name:g.company_name,contact_name:g.contact_name,project_type:g.project_type,status:g.status,created_at:g.created_at};return m.$X.CREATED(_,"Quote request")}catch(e){return console.error("Quote request creation error:",e),m.Gl.SERVER_ERROR("Failed to create quote request")}}let _=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/quotes/route",pathname:"/api/quotes",filename:"route",bundlePath:"app/api/quotes/route"},resolvedPagePath:"/Users/denizhan/Documents/Windsurf/protekanalitik/src/app/api/quotes/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:E,staticGenerationAsyncStorage:I,serverHooks:R,headerHooks:T,staticGenerationBailout:S}=_,k="/api/quotes/route";function w(){return(0,i.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:I})}},9413:(e,t,r)=>{r.d(t,{$X:()=>c,C4:()=>i,Gl:()=>o,MN:()=>u,jl:()=>n,x_:()=>s});var a=r(8070);function s(e,t,r){let s={success:!0,message:t,data:e,meta:{timestamp:new Date().toISOString(),version:"1.0.0",...r}};return a.Z.json(s)}function n(e,t,r=400,s){let n={success:!1,error:e,code:t,meta:{timestamp:new Date().toISOString(),version:"1.0.0",...s}};return a.Z.json(n,{status:r})}let i={MISSING_TOKEN:()=>n("Authentication token required","MISSING_TOKEN",401),INVALID_TOKEN:()=>n("Invalid or expired token","INVALID_TOKEN",401),INSUFFICIENT_PERMISSIONS:()=>n("Insufficient permissions","INSUFFICIENT_PERMISSIONS",403),RATE_LIMITED:e=>{let t=n("Too many requests. Please try again later.","RATE_LIMITED",429);return e&&t.headers.set("Retry-After",e.toString()),t}},o={NOT_FOUND:(e="Resource")=>n(`${e} not found`,"NOT_FOUND",404),ALREADY_EXISTS:(e="Resource")=>n(`${e} already exists`,"ALREADY_EXISTS",409),SERVER_ERROR:(e="Internal server error")=>n(e,"SERVER_ERROR",500),BAD_REQUEST:(e="Bad request")=>n(e,"BAD_REQUEST",400),FORBIDDEN:(e="Access forbidden")=>n(e,"FORBIDDEN",403)},c={CREATED:(e,t="Resource")=>s(e,`${t} created successfully`),UPDATED:(e,t="Resource")=>s(e,`${t} updated successfully`),DELETED:(e="Resource")=>s(null,`${e} deleted successfully`),FETCHED:(e,t="Resource")=>s(e,`${t} fetched successfully`)};function u(e,t){let r=t.filter(t=>void 0===e[t]||null===e[t]||""===e[t]);return{isValid:0===r.length,missingFields:r}}class l{static{this.requests=new Map}static isRateLimited(e,t=100,r=6e4){let a=Date.now(),s=this.requests.get(e);return!s||a>s.resetTime?(this.requests.set(e,{count:1,resetTime:a+r}),!1):s.count>=t||(s.count++,!1)}static getRemainingRequests(e,t=100){let r=this.requests.get(e);return r?Math.max(0,t-r.count):t}static cleanup(){let e=Date.now();for(let[t,r]of Array.from(this.requests.entries()))e>r.resetTime&&this.requests.delete(t)}}"undefined"!=typeof setInterval&&setInterval(()=>{l.cleanup()},3e5)},2002:(e,t,r)=>{r.d(t,{e8:()=>d,pS:()=>l});var a=r(9616),s=r(1865);r(7529);var n=r(6176);let i=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-in-production",o=process.env.JWT_ACCESS_EXPIRES_IN||"15m",c=process.env.JWT_REFRESH_EXPIRES_IN||"7d";class u{static getSecret(){return new TextEncoder().encode(i)}static async generateAccessToken(e){let t={sub:e.id,username:e.username,email:e.email,role:e.role,type:"access"};return await new a.N(t).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(o).sign(this.getSecret())}static async generateRefreshToken(e){let t={sub:e.id,username:e.username,email:e.email,role:e.role,type:"refresh"};return await new a.N(t).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(c).sign(this.getSecret())}static async verifyToken(e){try{let{payload:t}=await (0,s._)(e,this.getSecret());return{success:!0,payload:t}}catch(e){return{success:!1,error:e.message||"Invalid token"}}}}class l{static{this.attempts=new Map}static isRateLimited(e,t=5,r=9e5){let a=Date.now(),s=this.attempts.get(e);return!s||a>s.resetTime?(this.attempts.set(e,{count:1,resetTime:a+r}),!1):s.count>=t||(s.count++,!1)}static clearAttempts(e){this.attempts.delete(e)}static resetRateLimit(e){this.attempts.delete(e)}static cleanup(){let e=Date.now(),t=[];this.attempts.forEach((r,a)=>{e>r.resetTime&&t.push(a)}),t.forEach(e=>{this.attempts.delete(e)})}}class d{static async authenticate(e,t){try{if("protekadmin"!==e&&"admin@protekanalitik.com"!==e||"protek1234"!==t)return{success:!1,error:"Ge\xe7ersiz kullanıcı adı veya şifre"};{let e={id:"admin-001",username:"protekadmin",email:"admin@protekanalitik.com",first_name:"Admin",last_name:"User",role:"admin",is_active:!0,last_login:n.l3.formatDate(),created_at:n.l3.formatDate(),updated_at:n.l3.formatDate()},t=await u.generateAccessToken(e),r=await u.generateRefreshToken(e);return{success:!0,user:e,accessToken:t,refreshToken:r}}}catch(e){return console.error("Authentication error:",e),{success:!1,error:"Kimlik doğrulama sırasında hata oluştu"}}}static async refreshAccessToken(e){try{let t=await u.verifyToken(e);if(!t.success||!t.payload)return{success:!1,error:"Ge\xe7ersiz refresh token"};if("refresh"!==t.payload.type)return{success:!1,error:"Ge\xe7ersiz token tipi"};let r={id:t.payload.sub,username:t.payload.username,email:t.payload.email,role:t.payload.role,is_active:!0,created_at:n.l3.formatDate(),updated_at:n.l3.formatDate()},a=await u.generateAccessToken(r);return{success:!0,user:r,accessToken:a,refreshToken:e}}catch(e){return console.error("Token refresh error:",e),{success:!1,error:"Token yenileme sırasında hata oluştu"}}}static async verifyAccessToken(e){try{let t=await u.verifyToken(e);if(!t.success||!t.payload)return{success:!1,error:"Ge\xe7ersiz token"};if("access"!==t.payload.type)return{success:!1,error:"Ge\xe7ersiz token tipi"};let r={id:t.payload.sub,username:t.payload.username,email:t.payload.email,role:t.payload.role,is_active:!0,created_at:n.l3.formatDate(),updated_at:n.l3.formatDate()};return{success:!0,user:r}}catch(e){return console.error("Token verification error:",e),{success:!1,error:"Token doğrulama sırasında hata oluştu"}}}static hasRole(e,t){let r={viewer:1,editor:2,admin:3,super_admin:4};return r[e.role]>=r[t]}static async generatePasswordResetToken(e){let t={sub:e,type:"password_reset",exp:Math.floor(Date.now()/1e3)+3600};return await new a.N(t).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1h").sign(u.getSecret())}static async verifyPasswordResetToken(e){try{let t=await u.verifyToken(e);if(!t.success||!t.payload||"password_reset"!==t.payload.type)return{success:!1,error:"Ge\xe7ersiz şifre sıfırlama token"};return{success:!0,userId:t.payload.sub}}catch(e){return console.error("Password reset token verification error:",e),{success:!1,error:"Token doğrulama sırasında hata oluştu"}}}}},6176:(e,t,r)=>{r.d(t,{l3:()=>a,v$:()=>s});let a={generateId:()=>crypto.randomUUID(),toJson:e=>JSON.stringify(e),fromJson:e=>{if(!e)return null;try{return JSON.parse(e)}catch{return null}},generateSlug:e=>e.toLowerCase().replace(/ğ/g,"g").replace(/ü/g,"u").replace(/ş/g,"s").replace(/ı/g,"i").replace(/ö/g,"o").replace(/ç/g,"c").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),formatDate:(e=new Date)=>e.toISOString(),getPaginationParams:(e=1,t=20)=>({limit:t,offset:(e-1)*t})},s={isValidEmail:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),isValidPhone:e=>/^[\+]?[0-9\s\-\(\)]{10,}$/.test(e),isValidUrl:e=>{try{return new URL(e),!0}catch{return!1}},sanitizeHtml:e=>e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+="[^"]*"/gi,"")}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,5669],()=>r(450));module.exports=a})();