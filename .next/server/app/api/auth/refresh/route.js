"use strict";(()=>{var e={};e.id=9575,e.ids=[9575],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},3643:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>k,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>f});var s={};t.r(s),t.d(s,{POST:()=>u});var a=t(5419),o=t(9108),n=t(9678),i=t(8070),c=t(2002);async function u(e){try{let r=e.cookies.get("refreshToken")?.value;if(r||(r=(await e.json()).refreshToken),!r)return i.Z.json({success:!1,error:"Refresh token bulunamadı",code:"MISSING_REFRESH_TOKEN"},{status:401});let t=await c.e8.refreshAccessToken(r);if(!t.success){let e=i.Z.json({success:!1,error:t.error||"Token yenileme başarısız",code:"REFRESH_FAILED"},{status:401});return e.cookies.delete("accessToken"),e.cookies.delete("refreshToken"),e}let s=i.Z.json({success:!0,message:"Token başarıyla yenilendi",data:{user:{id:t.user.id,username:t.user.username,email:t.user.email,first_name:t.user.first_name,last_name:t.user.last_name,role:t.user.role},accessToken:t.accessToken,expiresIn:900}});return s.cookies.set("accessToken",t.accessToken,{httpOnly:!0,secure:!0,sameSite:"strict",path:"/",maxAge:900}),s}catch(e){return console.error("Token refresh error:",e),i.Z.json({success:!1,error:"Sunucu hatası oluştu",code:"SERVER_ERROR"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/refresh/route",pathname:"/api/auth/refresh",filename:"route",bundlePath:"app/api/auth/refresh/route"},resolvedPagePath:"/Users/denizhan/Documents/Windsurf/protekanalitik/src/app/api/auth/refresh/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m,headerHooks:h,staticGenerationBailout:f}=l,k="/api/auth/refresh/route";function y(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},2002:(e,r,t)=>{t.d(r,{e8:()=>d,pS:()=>l});var s=t(9616),a=t(1865);t(7529);var o=t(6176);let n=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-in-production",i=process.env.JWT_ACCESS_EXPIRES_IN||"15m",c=process.env.JWT_REFRESH_EXPIRES_IN||"7d";class u{static getSecret(){return new TextEncoder().encode(n)}static async generateAccessToken(e){let r={sub:e.id,username:e.username,email:e.email,role:e.role,type:"access"};return await new s.N(r).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(i).sign(this.getSecret())}static async generateRefreshToken(e){let r={sub:e.id,username:e.username,email:e.email,role:e.role,type:"refresh"};return await new s.N(r).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(c).sign(this.getSecret())}static async verifyToken(e){try{let{payload:r}=await (0,a._)(e,this.getSecret());return{success:!0,payload:r}}catch(e){return{success:!1,error:e.message||"Invalid token"}}}}class l{static{this.attempts=new Map}static isRateLimited(e,r=5,t=9e5){let s=Date.now(),a=this.attempts.get(e);return!a||s>a.resetTime?(this.attempts.set(e,{count:1,resetTime:s+t}),!1):a.count>=r||(a.count++,!1)}static clearAttempts(e){this.attempts.delete(e)}static resetRateLimit(e){this.attempts.delete(e)}static cleanup(){let e=Date.now(),r=[];this.attempts.forEach((t,s)=>{e>t.resetTime&&r.push(s)}),r.forEach(e=>{this.attempts.delete(e)})}}class d{static async authenticate(e,r){try{if("protekadmin"!==e&&"admin@protekanalitik.com"!==e||"protek1234"!==r)return{success:!1,error:"Ge\xe7ersiz kullanıcı adı veya şifre"};{let e={id:"admin-001",username:"protekadmin",email:"admin@protekanalitik.com",first_name:"Admin",last_name:"User",role:"admin",is_active:!0,last_login:o.l3.formatDate(),created_at:o.l3.formatDate(),updated_at:o.l3.formatDate()},r=await u.generateAccessToken(e),t=await u.generateRefreshToken(e);return{success:!0,user:e,accessToken:r,refreshToken:t}}}catch(e){return console.error("Authentication error:",e),{success:!1,error:"Kimlik doğrulama sırasında hata oluştu"}}}static async refreshAccessToken(e){try{let r=await u.verifyToken(e);if(!r.success||!r.payload)return{success:!1,error:"Ge\xe7ersiz refresh token"};if("refresh"!==r.payload.type)return{success:!1,error:"Ge\xe7ersiz token tipi"};let t={id:r.payload.sub,username:r.payload.username,email:r.payload.email,role:r.payload.role,is_active:!0,created_at:o.l3.formatDate(),updated_at:o.l3.formatDate()},s=await u.generateAccessToken(t);return{success:!0,user:t,accessToken:s,refreshToken:e}}catch(e){return console.error("Token refresh error:",e),{success:!1,error:"Token yenileme sırasında hata oluştu"}}}static async verifyAccessToken(e){try{let r=await u.verifyToken(e);if(!r.success||!r.payload)return{success:!1,error:"Ge\xe7ersiz token"};if("access"!==r.payload.type)return{success:!1,error:"Ge\xe7ersiz token tipi"};let t={id:r.payload.sub,username:r.payload.username,email:r.payload.email,role:r.payload.role,is_active:!0,created_at:o.l3.formatDate(),updated_at:o.l3.formatDate()};return{success:!0,user:t}}catch(e){return console.error("Token verification error:",e),{success:!1,error:"Token doğrulama sırasında hata oluştu"}}}static hasRole(e,r){let t={viewer:1,editor:2,admin:3,super_admin:4};return t[e.role]>=t[r]}static async generatePasswordResetToken(e){let r={sub:e,type:"password_reset",exp:Math.floor(Date.now()/1e3)+3600};return await new s.N(r).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1h").sign(u.getSecret())}static async verifyPasswordResetToken(e){try{let r=await u.verifyToken(e);if(!r.success||!r.payload||"password_reset"!==r.payload.type)return{success:!1,error:"Ge\xe7ersiz şifre sıfırlama token"};return{success:!0,userId:r.payload.sub}}catch(e){return console.error("Password reset token verification error:",e),{success:!1,error:"Token doğrulama sırasında hata oluştu"}}}}},6176:(e,r,t)=>{t.d(r,{l3:()=>s,v$:()=>a});let s={generateId:()=>crypto.randomUUID(),toJson:e=>JSON.stringify(e),fromJson:e=>{if(!e)return null;try{return JSON.parse(e)}catch{return null}},generateSlug:e=>e.toLowerCase().replace(/ğ/g,"g").replace(/ü/g,"u").replace(/ş/g,"s").replace(/ı/g,"i").replace(/ö/g,"o").replace(/ç/g,"c").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),formatDate:(e=new Date)=>e.toISOString(),getPaginationParams:(e=1,r=20)=>({limit:r,offset:(e-1)*r})},a={isValidEmail:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),isValidPhone:e=>/^[\+]?[0-9\s\-\(\)]{10,}$/.test(e),isValidUrl:e=>{try{return new URL(e),!0}catch{return!1}},sanitizeHtml:e=>e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+="[^"]*"/gi,"")}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,5669],()=>t(3643));module.exports=s})();