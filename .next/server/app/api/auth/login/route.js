"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},1584:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>f,patchFetch:()=>k,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>g});var a={};r.r(a),r.d(a,{POST:()=>u});var s=r(5419),i=r(9108),o=r(9678),n=r(8070),c=r(2002);async function u(e){try{let t=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown";if(c.pS.isRateLimited(t,5,9e5))return n.Z.json({success:!1,error:"\xc7ok fazla giriş denemesi. 15 dakika sonra tekrar deneyin.",code:"RATE_LIMITED"},{status:429});let{usernameOrEmail:r,password:a,rememberMe:s=!1}=await e.json();if(!r||!a)return n.Z.json({success:!1,error:"Kullanıcı adı/e-posta ve şifre gereklidir",code:"MISSING_CREDENTIALS"},{status:400});if(r.length<3||a.length<6)return n.Z.json({success:!1,error:"Ge\xe7ersiz kimlik bilgileri",code:"INVALID_CREDENTIALS"},{status:400});let i=await c.e8.authenticate(r,a);if(!i.success)return n.Z.json({success:!1,error:i.error||"Kimlik doğrulama başarısız",code:"AUTH_FAILED"},{status:401});c.pS.resetRateLimit(t);let o=n.Z.json({success:!0,message:"Giriş başarılı",data:{user:{id:i.user.id,username:i.user.username,email:i.user.email,first_name:i.user.first_name,last_name:i.user.last_name,role:i.user.role,last_login:i.user.last_login},accessToken:i.accessToken,refreshToken:i.refreshToken,expiresIn:900}}),u={httpOnly:!0,secure:!0,sameSite:"strict",path:"/"};return o.cookies.set("accessToken",i.accessToken,{...u,maxAge:900}),o.cookies.set("refreshToken",i.refreshToken,{...u,maxAge:s?604800:86400}),o}catch(e){return console.error("Login error:",e),n.Z.json({success:!1,error:"Sunucu hatası oluştu",code:"SERVER_ERROR"},{status:500})}}setInterval(()=>{c.pS.cleanup()},3e5);let l=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/denizhan/Documents/Windsurf/protekanalitik/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m,headerHooks:h,staticGenerationBailout:g}=l,f="/api/auth/login/route";function k(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},2002:(e,t,r)=>{r.d(t,{e8:()=>d,pS:()=>l});var a=r(9616),s=r(1865);r(7529);var i=r(6176);let o=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-in-production",n=process.env.JWT_ACCESS_EXPIRES_IN||"15m",c=process.env.JWT_REFRESH_EXPIRES_IN||"7d";class u{static getSecret(){return new TextEncoder().encode(o)}static async generateAccessToken(e){let t={sub:e.id,username:e.username,email:e.email,role:e.role,type:"access"};return await new a.N(t).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(n).sign(this.getSecret())}static async generateRefreshToken(e){let t={sub:e.id,username:e.username,email:e.email,role:e.role,type:"refresh"};return await new a.N(t).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(c).sign(this.getSecret())}static async verifyToken(e){try{let{payload:t}=await (0,s._)(e,this.getSecret());return{success:!0,payload:t}}catch(e){return{success:!1,error:e.message||"Invalid token"}}}}class l{static{this.attempts=new Map}static isRateLimited(e,t=5,r=9e5){let a=Date.now(),s=this.attempts.get(e);return!s||a>s.resetTime?(this.attempts.set(e,{count:1,resetTime:a+r}),!1):s.count>=t||(s.count++,!1)}static clearAttempts(e){this.attempts.delete(e)}static resetRateLimit(e){this.attempts.delete(e)}static cleanup(){let e=Date.now(),t=[];this.attempts.forEach((r,a)=>{e>r.resetTime&&t.push(a)}),t.forEach(e=>{this.attempts.delete(e)})}}class d{static async authenticate(e,t){try{if("protekadmin"!==e&&"admin@protekanalitik.com"!==e||"protek1234"!==t)return{success:!1,error:"Ge\xe7ersiz kullanıcı adı veya şifre"};{let e={id:"admin-001",username:"protekadmin",email:"admin@protekanalitik.com",first_name:"Admin",last_name:"User",role:"admin",is_active:!0,last_login:i.l3.formatDate(),created_at:i.l3.formatDate(),updated_at:i.l3.formatDate()},t=await u.generateAccessToken(e),r=await u.generateRefreshToken(e);return{success:!0,user:e,accessToken:t,refreshToken:r}}}catch(e){return console.error("Authentication error:",e),{success:!1,error:"Kimlik doğrulama sırasında hata oluştu"}}}static async refreshAccessToken(e){try{let t=await u.verifyToken(e);if(!t.success||!t.payload)return{success:!1,error:"Ge\xe7ersiz refresh token"};if("refresh"!==t.payload.type)return{success:!1,error:"Ge\xe7ersiz token tipi"};let r={id:t.payload.sub,username:t.payload.username,email:t.payload.email,role:t.payload.role,is_active:!0,created_at:i.l3.formatDate(),updated_at:i.l3.formatDate()},a=await u.generateAccessToken(r);return{success:!0,user:r,accessToken:a,refreshToken:e}}catch(e){return console.error("Token refresh error:",e),{success:!1,error:"Token yenileme sırasında hata oluştu"}}}static async verifyAccessToken(e){try{let t=await u.verifyToken(e);if(!t.success||!t.payload)return{success:!1,error:"Ge\xe7ersiz token"};if("access"!==t.payload.type)return{success:!1,error:"Ge\xe7ersiz token tipi"};let r={id:t.payload.sub,username:t.payload.username,email:t.payload.email,role:t.payload.role,is_active:!0,created_at:i.l3.formatDate(),updated_at:i.l3.formatDate()};return{success:!0,user:r}}catch(e){return console.error("Token verification error:",e),{success:!1,error:"Token doğrulama sırasında hata oluştu"}}}static hasRole(e,t){let r={viewer:1,editor:2,admin:3,super_admin:4};return r[e.role]>=r[t]}static async generatePasswordResetToken(e){let t={sub:e,type:"password_reset",exp:Math.floor(Date.now()/1e3)+3600};return await new a.N(t).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1h").sign(u.getSecret())}static async verifyPasswordResetToken(e){try{let t=await u.verifyToken(e);if(!t.success||!t.payload||"password_reset"!==t.payload.type)return{success:!1,error:"Ge\xe7ersiz şifre sıfırlama token"};return{success:!0,userId:t.payload.sub}}catch(e){return console.error("Password reset token verification error:",e),{success:!1,error:"Token doğrulama sırasında hata oluştu"}}}}},6176:(e,t,r)=>{r.d(t,{l3:()=>a,v$:()=>s});let a={generateId:()=>crypto.randomUUID(),toJson:e=>JSON.stringify(e),fromJson:e=>{if(!e)return null;try{return JSON.parse(e)}catch{return null}},generateSlug:e=>e.toLowerCase().replace(/ğ/g,"g").replace(/ü/g,"u").replace(/ş/g,"s").replace(/ı/g,"i").replace(/ö/g,"o").replace(/ç/g,"c").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),formatDate:(e=new Date)=>e.toISOString(),getPaginationParams:(e=1,t=20)=>({limit:t,offset:(e-1)*t})},s={isValidEmail:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),isValidPhone:e=>/^[\+]?[0-9\s\-\(\)]{10,}$/.test(e),isValidUrl:e=>{try{return new URL(e),!0}catch{return!1}},sanitizeHtml:e=>e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+="[^"]*"/gi,"")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,5669],()=>r(1584));module.exports=a})();