"use strict";exports.id=6458,exports.ids=[6458],exports.modules={2002:(e,r,t)=>{t.d(r,{e8:()=>d,pS:()=>l});var a=t(9616),s=t(1865);t(7529);var c=t(6176);let o=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-in-production",n=process.env.JWT_ACCESS_EXPIRES_IN||"15m",i=process.env.JWT_REFRESH_EXPIRES_IN||"7d";class u{static getSecret(){return new TextEncoder().encode(o)}static async generateAccessToken(e){let r={sub:e.id,username:e.username,email:e.email,role:e.role,type:"access"};return await new a.N(r).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(n).sign(this.getSecret())}static async generateRefreshToken(e){let r={sub:e.id,username:e.username,email:e.email,role:e.role,type:"refresh"};return await new a.N(r).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(i).sign(this.getSecret())}static async verifyToken(e){try{let{payload:r}=await (0,s._)(e,this.getSecret());return{success:!0,payload:r}}catch(e){return{success:!1,error:e.message||"Invalid token"}}}}class l{static{this.attempts=new Map}static isRateLimited(e,r=5,t=9e5){let a=Date.now(),s=this.attempts.get(e);return!s||a>s.resetTime?(this.attempts.set(e,{count:1,resetTime:a+t}),!1):s.count>=r||(s.count++,!1)}static clearAttempts(e){this.attempts.delete(e)}static resetRateLimit(e){this.attempts.delete(e)}static cleanup(){let e=Date.now(),r=[];this.attempts.forEach((t,a)=>{e>t.resetTime&&r.push(a)}),r.forEach(e=>{this.attempts.delete(e)})}}class d{static async authenticate(e,r){try{if("protekadmin"!==e&&"admin@protekanalitik.com"!==e||"protek1234"!==r)return{success:!1,error:"Ge\xe7ersiz kullanıcı adı veya şifre"};{let e={id:"admin-001",username:"protekadmin",email:"admin@protekanalitik.com",first_name:"Admin",last_name:"User",role:"admin",is_active:!0,last_login:c.l3.formatDate(),created_at:c.l3.formatDate(),updated_at:c.l3.formatDate()},r=await u.generateAccessToken(e),t=await u.generateRefreshToken(e);return{success:!0,user:e,accessToken:r,refreshToken:t}}}catch(e){return console.error("Authentication error:",e),{success:!1,error:"Kimlik doğrulama sırasında hata oluştu"}}}static async refreshAccessToken(e){try{let r=await u.verifyToken(e);if(!r.success||!r.payload)return{success:!1,error:"Ge\xe7ersiz refresh token"};if("refresh"!==r.payload.type)return{success:!1,error:"Ge\xe7ersiz token tipi"};let t={id:r.payload.sub,username:r.payload.username,email:r.payload.email,role:r.payload.role,is_active:!0,created_at:c.l3.formatDate(),updated_at:c.l3.formatDate()},a=await u.generateAccessToken(t);return{success:!0,user:t,accessToken:a,refreshToken:e}}catch(e){return console.error("Token refresh error:",e),{success:!1,error:"Token yenileme sırasında hata oluştu"}}}static async verifyAccessToken(e){try{let r=await u.verifyToken(e);if(!r.success||!r.payload)return{success:!1,error:"Ge\xe7ersiz token"};if("access"!==r.payload.type)return{success:!1,error:"Ge\xe7ersiz token tipi"};let t={id:r.payload.sub,username:r.payload.username,email:r.payload.email,role:r.payload.role,is_active:!0,created_at:c.l3.formatDate(),updated_at:c.l3.formatDate()};return{success:!0,user:t}}catch(e){return console.error("Token verification error:",e),{success:!1,error:"Token doğrulama sırasında hata oluştu"}}}static hasRole(e,r){let t={viewer:1,editor:2,admin:3,super_admin:4};return t[e.role]>=t[r]}static async generatePasswordResetToken(e){let r={sub:e,type:"password_reset",exp:Math.floor(Date.now()/1e3)+3600};return await new a.N(r).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1h").sign(u.getSecret())}static async verifyPasswordResetToken(e){try{let r=await u.verifyToken(e);if(!r.success||!r.payload||"password_reset"!==r.payload.type)return{success:!1,error:"Ge\xe7ersiz şifre sıfırlama token"};return{success:!0,userId:r.payload.sub}}catch(e){return console.error("Password reset token verification error:",e),{success:!1,error:"Token doğrulama sırasında hata oluştu"}}}}},7935:(e,r,t)=>{t.d(r,{TQ:()=>a,cf:()=>c,ki:()=>s});class a{constructor(){this.db=null,"undefined"!=typeof globalThis&&globalThis.DB&&(this.db=globalThis.DB)}getDatabase(){if(!this.db)throw Error("D1 Database not available. Make sure you're running in Cloudflare Workers environment.");return this.db}async executeQuery(e,r=[]){try{let t=this.getDatabase().prepare(e),a=await t.bind(...r).all();return{success:!0,data:a.results,meta:a.meta}}catch(e){return console.error("D1 Query Error:",e),{success:!1,error:e instanceof Error?e.message:"Database query failed"}}}async executeQueryFirst(e,r=[]){try{let t=this.getDatabase().prepare(e),a=await t.bind(...r).first();return{success:!0,data:a}}catch(e){return console.error("D1 Query Error:",e),{success:!1,error:e instanceof Error?e.message:"Database query failed"}}}async executeTransaction(e){try{let r=this.getDatabase(),t=e.map(({query:e,params:t=[]})=>r.prepare(e).bind(...t)),a=await r.batch(t);return{success:!0,results:a.map(e=>e.results)}}catch(e){return console.error("D1 Transaction Error:",e),{success:!1,error:e instanceof Error?e.message:"Database transaction failed"}}}async insertRecord(e,r){try{let t=Object.keys(r),a=t.map(()=>"?").join(", "),s=Object.values(r),c=`INSERT INTO ${e} (${t.join(", ")}) VALUES (${a})`,o=this.getDatabase(),n=await o.prepare(c).bind(...s).run();if(n.success)return{success:!0,id:r.id||n.meta.last_row_id?.toString()};return{success:!1,error:"Insert failed"}}catch(e){return console.error("D1 Insert Error:",e),{success:!1,error:e instanceof Error?e.message:"Insert failed"}}}async updateRecord(e,r,t){try{let a=Object.keys(t).map(e=>`${e} = ?`).join(", "),s=[...Object.values(t),r],c=`UPDATE ${e} SET ${a} WHERE id = ?`,o=this.getDatabase(),n=await o.prepare(c).bind(...s).run();return{success:n.success&&(n.meta.changes||0)>0}}catch(e){return console.error("D1 Update Error:",e),{success:!1,error:e instanceof Error?e.message:"Update failed"}}}async deleteRecord(e,r){try{let t=`DELETE FROM ${e} WHERE id = ?`,a=this.getDatabase(),s=await a.prepare(t).bind(r).run();return{success:s.success&&(s.meta.changes||0)>0}}catch(e){return console.error("D1 Delete Error:",e),{success:!1,error:e instanceof Error?e.message:"Delete failed"}}}async getRecords(e,r={}){try{let{where:t="",params:a=[],orderBy:s="created_at DESC",limit:c=50,offset:o=0}=r,n=`SELECT * FROM ${e}`,i=`SELECT COUNT(*) as total FROM ${e}`;t&&(n+=` WHERE ${t}`,i+=` WHERE ${t}`),n+=` ORDER BY ${s} LIMIT ${c} OFFSET ${o}`;let[u,l]=await Promise.all([this.executeQuery(n,a),this.executeQueryFirst(i,a)]);if(!u.success||!l.success)return{success:!1,error:u.error||l.error};return{success:!0,data:u.data,total:l.data?.total||0}}catch(e){return console.error("D1 Get Records Error:",e),{success:!1,error:e instanceof Error?e.message:"Get records failed"}}}async getRecordById(e,r){return this.executeQueryFirst(`SELECT * FROM ${e} WHERE id = ?`,[r])}isAvailable(){return null!==this.db}}let s=new a,c={generateId:()=>crypto.randomUUID(),toJson:e=>JSON.stringify(e),fromJson:e=>{if(!e)return null;try{return JSON.parse(e)}catch{return null}},formatDate:(e=new Date)=>e.toISOString(),generateSlug:e=>e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""),async getProductById(e){try{let r=await s.getRecordById("products",e);if(r.success&&r.data)return r.data;return null}catch(e){return console.error("Error fetching product by ID:",e),null}},async updateProduct(e,r){try{let t={...r,updated_at:c.formatDate()};if(r.images&&(t.images=c.toJson(r.images)),r.features&&(t.features=c.toJson(r.features)),r.applications&&(t.applications=c.toJson(r.applications)),r.specifications&&(t.specifications=c.toJson(r.specifications)),r.catalog_files&&(t.catalog_files=c.toJson(r.catalog_files)),(await s.updateRecord("products",e,t)).success)return await c.getProductById(e);return null}catch(e){return console.error("Error updating product:",e),null}},async deleteProduct(e){try{return(await s.deleteRecord("products",e)).success}catch(e){return console.error("Error deleting product:",e),!1}}}},6176:(e,r,t)=>{t.d(r,{l3:()=>a,v$:()=>s});let a={generateId:()=>crypto.randomUUID(),toJson:e=>JSON.stringify(e),fromJson:e=>{if(!e)return null;try{return JSON.parse(e)}catch{return null}},generateSlug:e=>e.toLowerCase().replace(/ğ/g,"g").replace(/ü/g,"u").replace(/ş/g,"s").replace(/ı/g,"i").replace(/ö/g,"o").replace(/ç/g,"c").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),formatDate:(e=new Date)=>e.toISOString(),getPaginationParams:(e=1,r=20)=>({limit:r,offset:(e-1)*r})},s={isValidEmail:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),isValidPhone:e=>/^[\+]?[0-9\s\-\(\)]{10,}$/.test(e),isValidUrl:e=>{try{return new URL(e),!0}catch{return!1}},sanitizeHtml:e=>e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+="[^"]*"/gi,"")}}};