var G={},$e=(Ce,Ke,We)=>(G.__chunk_3442=(ne,x,D)=>{"use strict";D.d(x,{l3:()=>k,v$:()=>p});let k={generateId:()=>crypto.randomUUID(),toJson:c=>JSON.stringify(c),fromJson:c=>{if(!c)return null;try{return JSON.parse(c)}catch{return null}},generateSlug:c=>c.toLowerCase().replace(/ğ/g,"g").replace(/ü/g,"u").replace(/ş/g,"s").replace(/ı/g,"i").replace(/ö/g,"o").replace(/ç/g,"c").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),formatDate:(c=new Date)=>c.toISOString(),getPaginationParams:(c=1,K=20)=>({limit:K,offset:(c-1)*K})},p={isValidEmail:c=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c),isValidPhone:c=>/^[\+]?[0-9\s\-\(\)]{10,}$/.test(c),isValidUrl:c=>{try{return new URL(c),!0}catch{return!1}},sanitizeHtml:c=>c.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+="[^"]*"/gi,"")}},G.__chunk_2887=(ne,x,D)=>{"use strict";let k;D.d(x,{e8:()=>Re,pS:()=>_e});let p=new TextEncoder,c=new TextDecoder;function K(...t){let e=t.reduce((s,{length:i})=>s+i,0),r=new Uint8Array(e),a=0;for(let s of t)r.set(s,a),a+=s.length;return r}function O(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof t=="string"?t:c.decode(t),{alphabet:"base64url"});let e=t;e instanceof Uint8Array&&(e=c.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return function(r){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(r);let a=atob(r),s=new Uint8Array(a.length);for(let i=0;i<a.length;i++)s[i]=a.charCodeAt(i);return s}(e)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function N(t){let e=t;return typeof e=="string"&&(e=p.encode(e)),Uint8Array.prototype.toBase64?e.toBase64({alphabet:"base64url",omitPadding:!0}):function(r){if(Uint8Array.prototype.toBase64)return r.toBase64();let a=[];for(let s=0;s<r.length;s+=32768)a.push(String.fromCharCode.apply(null,r.subarray(s,s+32768)));return btoa(a.join(""))}(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class h extends Error{static{this.code="ERR_JOSE_GENERIC"}constructor(e,r){super(e,r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class y extends h{static{this.code="ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,r,a="unspecified",s="unspecified"){super(e,{cause:{claim:a,reason:s,payload:r}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=a,this.reason=s,this.payload=r}}class V extends h{static{this.code="ERR_JWT_EXPIRED"}constructor(e,r,a="unspecified",s="unspecified"){super(e,{cause:{claim:a,reason:s,payload:r}}),this.code="ERR_JWT_EXPIRED",this.claim=a,this.reason=s,this.payload=r}}class ce extends h{static{this.code="ERR_JOSE_ALG_NOT_ALLOWED"}constructor(...e){super(...e),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}class _ extends h{static{this.code="ERR_JOSE_NOT_SUPPORTED"}constructor(...e){super(...e),this.code="ERR_JOSE_NOT_SUPPORTED"}}class He extends h{static{this.code="ERR_JWE_DECRYPTION_FAILED"}constructor(e="decryption operation failed",r){super(e,r),this.code="ERR_JWE_DECRYPTION_FAILED"}}class Ie extends h{static{this.code="ERR_JWE_INVALID"}constructor(...e){super(...e),this.code="ERR_JWE_INVALID"}}class d extends h{static{this.code="ERR_JWS_INVALID"}constructor(...e){super(...e),this.code="ERR_JWS_INVALID"}}class $ extends h{static{this.code="ERR_JWT_INVALID"}constructor(...e){super(...e),this.code="ERR_JWT_INVALID"}}class Je extends h{static{this.code="ERR_JWK_INVALID"}constructor(...e){super(...e),this.code="ERR_JWK_INVALID"}}class De extends h{static{this.code="ERR_JWKS_INVALID"}constructor(...e){super(...e),this.code="ERR_JWKS_INVALID"}}class Oe extends h{static{this.code="ERR_JWKS_NO_MATCHING_KEY"}constructor(e="no applicable key found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_NO_MATCHING_KEY"}}class xe extends h{static{this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}constructor(e="multiple matching keys found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}class Ne extends h{static{this.code="ERR_JWKS_TIMEOUT"}constructor(e="request timed out",r){super(e,r),this.code="ERR_JWKS_TIMEOUT"}}class le extends h{static{this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}constructor(e="signature verification failed",r){super(e,r),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}function m(t,e="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function W(t,e){return t.name===e}function U(t){return parseInt(t.name.slice(4),10)}function F(t,e,...r){if((r=r.filter(Boolean)).length>2){let a=r.pop();t+=`one of type ${r.join(", ")}, or ${a}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&e.constructor?.name&&(t+=` Received an instance of ${e.constructor.name}`),t}let de=(t,...e)=>F("Key must be ",t,...e);function z(t,e,...r){return F(`Key for the ${t} algorithm must be `,e,...r)}function q(t){return t?.[Symbol.toStringTag]==="CryptoKey"}function Y(t){return t?.[Symbol.toStringTag]==="KeyObject"}let X=t=>q(t)||Y(t),Q=(...t)=>{let e,r=t.filter(Boolean);if(r.length===0||r.length===1)return!0;for(let a of r){let s=Object.keys(a);if(!e||e.size===0){e=new Set(s);continue}for(let i of s){if(e.has(i))return!1;e.add(i)}}return!0},H=t=>{if(!function(r){return typeof r=="object"&&r!==null}(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Z=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){let{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}},ue=async t=>{if(!t.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:e,keyUsages:r}=function(s){let i,o;switch(s.kty){case"RSA":switch(s.alg){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${s.alg.slice(-3)}`},o=s.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${s.alg.slice(-3)}`},o=s.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(s.alg.slice(-3),10)||1}`},o=s.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(s.alg){case"ES256":i={name:"ECDSA",namedCurve:"P-256"},o=s.d?["sign"]:["verify"];break;case"ES384":i={name:"ECDSA",namedCurve:"P-384"},o=s.d?["sign"]:["verify"];break;case"ES512":i={name:"ECDSA",namedCurve:"P-521"},o=s.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":i={name:"ECDH",namedCurve:s.crv},o=s.d?["deriveBits"]:[];break;default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(s.alg){case"Ed25519":case"EdDSA":i={name:"Ed25519"},o=s.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":i={name:s.crv},o=s.d?["deriveBits"]:[];break;default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new _('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:i,keyUsages:o}}(t),a={...t};return delete a.alg,delete a.use,crypto.subtle.importKey("jwk",a,e,t.ext??!t.d,t.key_ops??r)},ee=(t,e,r,a,s)=>{let i;if(s.crit!==void 0&&a?.crit===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||a.crit===void 0)return new Set;if(!Array.isArray(a.crit)||a.crit.length===0||a.crit.some(o=>typeof o!="string"||o.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let o of(i=r!==void 0?new Map([...Object.entries(r),...e.entries()]):e,a.crit)){if(!i.has(o))throw new _(`Extension Header Parameter "${o}" is not recognized`);if(s[o]===void 0)throw new t(`Extension Header Parameter "${o}" is missing`);if(i.get(o)&&a[o]===void 0)throw new t(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(a.crit)},he=(t,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(r=>typeof r!="string")))throw TypeError(`"${t}" option must be an array of strings`);if(e)return new Set(e)};function L(t){return H(t)&&typeof t.kty=="string"}let te=async(t,e,r,a=!1)=>{let s=(k||=new WeakMap).get(t);if(s?.[r])return s[r];let i=await ue({...e,alg:r});return a&&Object.freeze(t),s?s[r]=i:k.set(t,{[r]:i}),i},pe=(t,e)=>{let r,a=(k||=new WeakMap).get(t);if(a?.[e])return a[e];let s=t.type==="public",i=!!s;if(t.asymmetricKeyType==="x25519"){switch(e){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}r=t.toCryptoKey(t.asymmetricKeyType,i,s?[]:["deriveBits"])}if(t.asymmetricKeyType==="ed25519"){if(e!=="EdDSA"&&e!=="Ed25519")throw TypeError("given KeyObject instance cannot be used for this algorithm");r=t.toCryptoKey(t.asymmetricKeyType,i,[s?"verify":"sign"])}if(t.asymmetricKeyType==="rsa"){let o;switch(e){case"RSA-OAEP":o="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":o="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":o="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":o="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(e.startsWith("RSA-OAEP"))return t.toCryptoKey({name:"RSA-OAEP",hash:o},i,s?["encrypt"]:["decrypt"]);r=t.toCryptoKey({name:e.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:o},i,[s?"verify":"sign"])}if(t.asymmetricKeyType==="ec"){let o=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(t.asymmetricKeyDetails?.namedCurve);if(!o)throw TypeError("given KeyObject instance cannot be used for this algorithm");e==="ES256"&&o==="P-256"&&(r=t.toCryptoKey({name:"ECDSA",namedCurve:o},i,[s?"verify":"sign"])),e==="ES384"&&o==="P-384"&&(r=t.toCryptoKey({name:"ECDSA",namedCurve:o},i,[s?"verify":"sign"])),e==="ES512"&&o==="P-521"&&(r=t.toCryptoKey({name:"ECDSA",namedCurve:o},i,[s?"verify":"sign"])),e.startsWith("ECDH-ES")&&(r=t.toCryptoKey({name:"ECDH",namedCurve:o},i,s?[]:["deriveBits"]))}if(!r)throw TypeError("given KeyObject instance cannot be used for this algorithm");return a?a[e]=r:k.set(t,{[e]:r}),r},re=async(t,e)=>{if(t instanceof Uint8Array||q(t))return t;if(Y(t)){if(t.type==="secret")return t.export();if("toCryptoKey"in t&&typeof t.toCryptoKey=="function")try{return pe(t,e)}catch(a){if(a instanceof TypeError)throw a}let r=t.export({format:"jwk"});return te(t,r,e)}if(L(t))return t.k?O(t.k):te(t,t,e,!0);throw Error("unreachable")},R=t=>t?.[Symbol.toStringTag],j=(t,e,r)=>{if(e.use!==void 0){let a;switch(r){case"sign":case"verify":a="sig";break;case"encrypt":case"decrypt":a="enc"}if(e.use!==a)throw TypeError(`Invalid key for this operation, its "use" must be "${a}" when present`)}if(e.alg!==void 0&&e.alg!==t)throw TypeError(`Invalid key for this operation, its "alg" must be "${t}" when present`);if(Array.isArray(e.key_ops)){let a;switch(!0){case(r==="sign"||r==="verify"):case t==="dir":case t.includes("CBC-HS"):a=r;break;case t.startsWith("PBES2"):a="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(t):a=!t.includes("GCM")&&t.endsWith("KW")?r==="encrypt"?"wrapKey":"unwrapKey":r;break;case(r==="encrypt"&&t.startsWith("RSA")):a="wrapKey";break;case r==="decrypt":a=t.startsWith("RSA")?"unwrapKey":"deriveBits"}if(a&&e.key_ops?.includes?.(a)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${a}" when present`)}return!0},ye=(t,e,r)=>{if(!(e instanceof Uint8Array)){if(L(e)){if(function(a){return a.kty==="oct"&&typeof a.k=="string"}(e)&&j(t,e,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!X(e))throw TypeError(z(t,e,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(e.type!=="secret")throw TypeError(`${R(e)} instances for symmetric algorithms must be of type "secret"`)}},fe=(t,e,r)=>{if(L(e))switch(r){case"decrypt":case"sign":if(function(a){return a.kty!=="oct"&&typeof a.d=="string"}(e)&&j(t,e,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(function(a){return a.kty!=="oct"&&a.d===void 0}(e)&&j(t,e,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!X(e))throw TypeError(z(t,e,"CryptoKey","KeyObject","JSON Web Key"));if(e.type==="secret")throw TypeError(`${R(e)} instances for asymmetric algorithms must not be of type "secret"`);if(e.type==="public")switch(r){case"sign":throw TypeError(`${R(e)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${R(e)} instances for asymmetric algorithm decryption must be of type "private"`)}if(e.type==="private")switch(r){case"verify":throw TypeError(`${R(e)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${R(e)} instances for asymmetric algorithm encryption must be of type "public"`)}},ae=(t,e,r)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(t)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(t)?ye(t,e,r):fe(t,e,r)};Symbol();let se=(t,e)=>{let r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:parseInt(t.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};default:throw new _(`alg ${t} is not supported either by JOSE or your javascript runtime`)}},ie=async(t,e,r)=>{if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw TypeError(de(e,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}return function(a,s,i){switch(s){case"HS256":case"HS384":case"HS512":{if(!W(a.algorithm,"HMAC"))throw m("HMAC");let o=parseInt(s.slice(2),10);if(U(a.algorithm.hash)!==o)throw m(`SHA-${o}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!W(a.algorithm,"RSASSA-PKCS1-v1_5"))throw m("RSASSA-PKCS1-v1_5");let o=parseInt(s.slice(2),10);if(U(a.algorithm.hash)!==o)throw m(`SHA-${o}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!W(a.algorithm,"RSA-PSS"))throw m("RSA-PSS");let o=parseInt(s.slice(2),10);if(U(a.algorithm.hash)!==o)throw m(`SHA-${o}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!W(a.algorithm,"Ed25519"))throw m("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!W(a.algorithm,"ECDSA"))throw m("ECDSA");let o=function(l){switch(l){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(s);if(a.algorithm.namedCurve!==o)throw m(o,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}(function(o,l){if(l&&!o.usages.includes(l))throw TypeError(`CryptoKey does not support this operation, its usages must include ${l}.`)})(a,i)}(e,t,r),e},me=async(t,e,r,a)=>{let s=await ie(t,e,"verify");Z(t,s);let i=se(t,s.algorithm);try{return await crypto.subtle.verify(i,s,r,a)}catch{return!1}};async function we(t,e,r){let a,s;if(!H(t))throw new d("Flattened JWS must be an object");if(t.protected===void 0&&t.header===void 0)throw new d('Flattened JWS must have either of the "protected" or "header" members');if(t.protected!==void 0&&typeof t.protected!="string")throw new d("JWS Protected Header incorrect type");if(t.payload===void 0)throw new d("JWS Payload missing");if(typeof t.signature!="string")throw new d("JWS Signature missing or incorrect type");if(t.header!==void 0&&!H(t.header))throw new d("JWS Unprotected Header incorrect type");let i={};if(t.protected)try{let S=O(t.protected);i=JSON.parse(c.decode(S))}catch{throw new d("JWS Protected Header is invalid")}if(!Q(i,t.header))throw new d("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let o={...i,...t.header},l=ee(d,new Map([["b64",!0]]),r?.crit,i,o),n=!0;if(l.has("b64")&&typeof(n=i.b64)!="boolean")throw new d('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:u}=o;if(typeof u!="string"||!u)throw new d('JWS "alg" (Algorithm) Header Parameter missing or invalid');let T=r&&he("algorithms",r.algorithms);if(T&&!T.has(u))throw new ce('"alg" (Algorithm) Header Parameter value not allowed');if(n){if(typeof t.payload!="string")throw new d("JWS Payload must be a string")}else if(typeof t.payload!="string"&&!(t.payload instanceof Uint8Array))throw new d("JWS Payload must be a string or an Uint8Array instance");let w=!1;typeof e=="function"&&(e=await e(i,t),w=!0),ae(u,e,"verify");let v=K(p.encode(t.protected??""),p.encode("."),typeof t.payload=="string"?p.encode(t.payload):t.payload);try{a=O(t.signature)}catch{throw new d("Failed to base64url decode the signature")}let P=await re(e,u);if(!await me(u,P,a,v))throw new le;if(n)try{s=O(t.payload)}catch{throw new d("Failed to base64url decode the payload")}else s=typeof t.payload=="string"?p.encode(t.payload):t.payload;let f={payload:s};return t.protected!==void 0&&(f.protectedHeader=i),t.header!==void 0&&(f.unprotectedHeader=t.header),w?{...f,key:P}:f}async function ge(t,e,r){if(t instanceof Uint8Array&&(t=c.decode(t)),typeof t!="string")throw new d("Compact JWS must be a string or Uint8Array");let{0:a,1:s,2:i,length:o}=t.split(".");if(o!==3)throw new d("Invalid Compact JWS");let l=await we({payload:s,protected:a,signature:i},e,r),n={payload:l.payload,protectedHeader:l.protectedHeader};return typeof e=="function"?{...n,key:l.key}:n}let g=t=>Math.floor(t.getTime()/1e3),Se=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,I=t=>{let e,r=Se.exec(t);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let a=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":e=Math.round(a);break;case"minute":case"minutes":case"min":case"mins":case"m":e=Math.round(60*a);break;case"hour":case"hours":case"hr":case"hrs":case"h":e=Math.round(3600*a);break;case"day":case"days":case"d":e=Math.round(86400*a);break;case"week":case"weeks":case"w":e=Math.round(604800*a);break;default:e=Math.round(31557600*a)}return r[1]==="-"||r[4]==="ago"?-e:e};function E(t,e){if(!Number.isFinite(e))throw TypeError(`Invalid ${t} input`);return e}let oe=t=>t.includes("/")?t.toLowerCase():`application/${t.toLowerCase()}`,Ee=(t,e)=>typeof t=="string"?e.includes(t):!!Array.isArray(t)&&e.some(Set.prototype.has.bind(new Set(t)));class be{#e;constructor(e){if(!H(e))throw TypeError("JWT Claims Set MUST be an object");this.#e=structuredClone(e)}data(){return p.encode(JSON.stringify(this.#e))}get iss(){return this.#e.iss}set iss(e){this.#e.iss=e}get sub(){return this.#e.sub}set sub(e){this.#e.sub=e}get aud(){return this.#e.aud}set aud(e){this.#e.aud=e}set jti(e){this.#e.jti=e}set nbf(e){typeof e=="number"?this.#e.nbf=E("setNotBefore",e):e instanceof Date?this.#e.nbf=E("setNotBefore",g(e)):this.#e.nbf=g(new Date)+I(e)}set exp(e){typeof e=="number"?this.#e.exp=E("setExpirationTime",e):e instanceof Date?this.#e.exp=E("setExpirationTime",g(e)):this.#e.exp=g(new Date)+I(e)}set iat(e){e===void 0?this.#e.iat=g(new Date):e instanceof Date?this.#e.iat=E("setIssuedAt",g(e)):typeof e=="string"?this.#e.iat=E("setIssuedAt",g(new Date)+I(e)):this.#e.iat=E("setIssuedAt",e)}}async function Ae(t,e,r){let a=await ge(t,e,r);if(a.protectedHeader.crit?.includes("b64")&&a.protectedHeader.b64===!1)throw new $("JWTs MUST NOT use unencoded payload");let s={payload:function(i,o,l={}){let n,u;try{n=JSON.parse(c.decode(o))}catch{}if(!H(n))throw new $("JWT Claims Set must be a top-level JSON object");let{typ:T}=l;if(T&&(typeof i.typ!="string"||oe(i.typ)!==oe(T)))throw new y('unexpected "typ" JWT header value',n,"typ","check_failed");let{requiredClaims:w=[],issuer:v,subject:P,audience:f,maxTokenAge:S}=l,J=[...w];for(let C of(S!==void 0&&J.push("iat"),f!==void 0&&J.push("aud"),P!==void 0&&J.push("sub"),v!==void 0&&J.push("iss"),new Set(J.reverse())))if(!(C in n))throw new y(`missing required "${C}" claim`,n,C,"missing");if(v&&!(Array.isArray(v)?v:[v]).includes(n.iss))throw new y('unexpected "iss" claim value',n,"iss","check_failed");if(P&&n.sub!==P)throw new y('unexpected "sub" claim value',n,"sub","check_failed");if(f&&!Ee(n.aud,typeof f=="string"?[f]:f))throw new y('unexpected "aud" claim value',n,"aud","check_failed");switch(typeof l.clockTolerance){case"string":u=I(l.clockTolerance);break;case"number":u=l.clockTolerance;break;case"undefined":u=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:Pe}=l,B=g(Pe||new Date);if((n.iat!==void 0||S)&&typeof n.iat!="number")throw new y('"iat" claim must be a number',n,"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new y('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>B+u)throw new y('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new y('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=B-u)throw new V('"exp" claim timestamp check failed',n,"exp","check_failed")}if(S){let C=B-n.iat;if(C-u>(typeof S=="number"?S:I(S)))throw new V('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(C<0-u)throw new y('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n}(a.protectedHeader,a.payload,r),protectedHeader:a.protectedHeader};return typeof e=="function"?{...s,key:a.key}:s}let Te=async(t,e,r)=>{let a=await ie(t,e,"sign");Z(t,a);let s=await crypto.subtle.sign(se(t,a.algorithm),a,r);return new Uint8Array(s)};class ve{#e;#t;#r;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#e=e}setProtectedHeader(e){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=e,this}setUnprotectedHeader(e){if(this.#r)throw TypeError("setUnprotectedHeader can only be called once");return this.#r=e,this}async sign(e,r){let a;if(!this.#t&&!this.#r)throw new d("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Q(this.#t,this.#r))throw new d("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...this.#t,...this.#r},i=ee(d,new Map([["b64",!0]]),r?.crit,this.#t,s),o=!0;if(i.has("b64")&&typeof(o=this.#t.b64)!="boolean")throw new d('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:l}=s;if(typeof l!="string"||!l)throw new d('JWS "alg" (Algorithm) Header Parameter missing or invalid');ae(l,e,"sign");let n=this.#e;o&&(n=p.encode(N(n)));let u=K(a=this.#t?p.encode(N(JSON.stringify(this.#t))):p.encode(""),p.encode("."),n),T=await re(e,l),w={signature:N(await Te(l,T,u)),payload:""};return o&&(w.payload=c.decode(n)),this.#r&&(w.header=this.#r),this.#t&&(w.protected=c.decode(a)),w}}class ke{#e;constructor(e){this.#e=new ve(e)}setProtectedHeader(e){return this.#e.setProtectedHeader(e),this}async sign(e,r){let a=await this.#e.sign(e,r);if(a.payload===void 0)throw TypeError("use the flattened module for creating JWS with b64: false");return`${a.protected}.${a.payload}.${a.signature}`}}class M{#e;#t;constructor(e={}){this.#t=new be(e)}setIssuer(e){return this.#t.iss=e,this}setSubject(e){return this.#t.sub=e,this}setAudience(e){return this.#t.aud=e,this}setJti(e){return this.#t.jti=e,this}setNotBefore(e){return this.#t.nbf=e,this}setExpirationTime(e){return this.#t.exp=e,this}setIssuedAt(e){return this.#t.iat=e,this}setProtectedHeader(e){return this.#e=e,this}async sign(e,r){let a=new ke(this.#t.data());if(a.setProtectedHeader(this.#e),Array.isArray(this.#e?.crit)&&this.#e.crit.includes("b64")&&this.#e.b64===!1)throw new $("JWTs MUST NOT use unencoded payload");return a.sign(e,r)}}typeof navigator<"u"&&navigator.userAgent?.startsWith?.("Mozilla/5.0 "),Symbol(),Symbol();var b=D(3442);class A{static getSecret(){let e=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-this-in-production";return new TextEncoder().encode(e)}static async generateAccessToken(e){let r={sub:e.id,username:e.username,email:e.email,role:e.role,type:"access"};return await new M(r).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("15m").sign(this.getSecret())}static async generateRefreshToken(e){let r={sub:e.id,username:e.username,email:e.email,role:e.role,type:"refresh"};return await new M(r).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(this.getSecret())}static async verifyToken(e){try{let{payload:r}=await Ae(e,this.getSecret());return{success:!0,payload:r}}catch(r){return{success:!1,error:r.message||"Invalid token"}}}}class _e{static{this.attempts=new Map}static isRateLimited(e,r=5,a=9e5){let s=Date.now(),i=this.attempts.get(e);return!i||s>i.resetTime?(this.attempts.set(e,{count:1,resetTime:s+a}),!1):i.count>=r||(i.count++,!1)}static clearAttempts(e){this.attempts.delete(e)}static resetRateLimit(e){this.attempts.delete(e)}static cleanup(){let e=Date.now(),r=[];this.attempts.forEach((a,s)=>{e>a.resetTime&&r.push(s)}),r.forEach(a=>{this.attempts.delete(a)})}}class Re{static async authenticate(e,r){try{if(e!=="protekadmin"&&e!=="admin@protekanalitik.com"||r!=="protek1234")return{success:!1,error:"Ge\xE7ersiz kullan\u0131c\u0131 ad\u0131 veya \u015Fifre"};{let a={id:"admin-001",username:"protekadmin",email:"admin@protekanalitik.com",first_name:"Admin",last_name:"User",role:"admin",is_active:!0,last_login:b.l3.formatDate(),created_at:b.l3.formatDate(),updated_at:b.l3.formatDate()},s=await A.generateAccessToken(a),i=await A.generateRefreshToken(a);return{success:!0,user:a,accessToken:s,refreshToken:i}}}catch(a){return console.error("Authentication error:",a),{success:!1,error:"Kimlik do\u011Frulama s\u0131ras\u0131nda hata olu\u015Ftu"}}}static async refreshAccessToken(e){try{let r=await A.verifyToken(e);if(!r.success||!r.payload)return{success:!1,error:"Ge\xE7ersiz refresh token"};if(r.payload.type!=="refresh")return{success:!1,error:"Ge\xE7ersiz token tipi"};let a={id:r.payload.sub,username:r.payload.username,email:r.payload.email,role:r.payload.role,is_active:!0,created_at:b.l3.formatDate(),updated_at:b.l3.formatDate()},s=await A.generateAccessToken(a);return{success:!0,user:a,accessToken:s,refreshToken:e}}catch(r){return console.error("Token refresh error:",r),{success:!1,error:"Token yenileme s\u0131ras\u0131nda hata olu\u015Ftu"}}}static async verifyAccessToken(e){try{let r=await A.verifyToken(e);return!r.success||!r.payload?{success:!1,error:"Ge\xE7ersiz token"}:r.payload.type!=="access"?{success:!1,error:"Ge\xE7ersiz token tipi"}:{success:!0,user:{id:r.payload.sub,username:r.payload.username,email:r.payload.email,role:r.payload.role,is_active:!0,created_at:b.l3.formatDate(),updated_at:b.l3.formatDate()}}}catch(r){return console.error("Token verification error:",r),{success:!1,error:"Token do\u011Frulama s\u0131ras\u0131nda hata olu\u015Ftu"}}}static hasRole(e,r){let a={viewer:1,editor:2,admin:3,super_admin:4};return a[e.role]>=a[r]}static async generatePasswordResetToken(e){let r={sub:e,type:"password_reset",exp:Math.floor(Date.now()/1e3)+3600};return await new M(r).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1h").sign(A.getSecret())}static async verifyPasswordResetToken(e){try{let r=await A.verifyToken(e);return!r.success||!r.payload||r.payload.type!=="password_reset"?{success:!1,error:"Ge\xE7ersiz \u015Fifre s\u0131f\u0131rlama token"}:{success:!0,userId:r.payload.sub}}catch(r){return console.error("Password reset token verification error:",r),{success:!1,error:"Token do\u011Frulama s\u0131ras\u0131nda hata olu\u015Ftu"}}}}},G);export{$e as __getNamedExports};
